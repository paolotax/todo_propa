= content_for :add_button do
  .topbar-tweet-btn
    %a.btn.btn-primary{ "data-toggle" => "modal", "data-target" => ".modal" }
      .icon-tweet

.row
  .side-bar.span3
    .module
      %ul.stats
        %li
          = link_to "" do
            %strong= @fatture.size
            DOC
        %li
          = link_to "" do
            %strong= @fatture.sum(&:totale_copie)
            copie
        %li
          = link_to "" do
            %strong= @fatture.sum(&:importo_fattura)
            importo
    .module
      %ul
        %li{ class: "#{ params[:causale].present? ? '': 'active' }" }
          = link_to params.except(:causale), class: "list-link"  do
            Tutti 
            %i.chev-right
        - for c in Fattura::TIPO_FATTURA
          %li{ class: "#{ params[:causale] == c ? 'active' : ''}"}
            = link_to fatture_url(params.merge(:causale => c)), class: "list-link"  do
              = c.pluralize
              %i.chev-right
    .module
      %ul
        %li{ class: "#{ params[:anno].present? ? '': 'active' }" }
          = link_to params.except(:anno), class: "list-link"  do
            Anni 
            %i.chev-right

        - for c in ["2012", "2011"]
          %li{ class: "#{ params[:anno] == c ? 'active' : ''}"}
            = link_to fatture_url(params.merge(:anno => c)), class: "list-link"  do
              = c
              %i.chev-right
    .module
      %ul
        %li{ class: "#{ params[:pagamento].present? ? '': 'active' }" }
          = link_to params.except(:pagamento), class: "list-link"  do
            Pagamenti 
            %i.chev-right
        - for c in Fattura::TIPO_PAGAMENTO
          %li{ class: "#{ params[:pagamento] == c ? 'active' : ''}"}
            = link_to fatture_url(params.merge(:pagamento => c)), class: "list-link"  do
              = c
              %i.chev-right

  .content-main.span6
    %header.content-header
      .header-inner
        %h2 Documenti
    #fatture.list
      - @fatture_per_anno.each do |a, fatture|
        .item 
          %h3= a.strftime("%Y")
        - fatture.each do |fattura|
          = render fattura

  .side-bar.span3
    .module
      %ul
        %li
          %span.list-link.active 
            Pagamenti da registrare
        - unless @clienti_righe_da_fatturare.empty?
          - for c, r in @clienti_righe_da_fatturare do
            %li
              = link_to  c, class: "list-link" do
                %span.titolo= c[:titolo]
                %span.copie
                  %small= r.sum(&:quantita)
                %span.importo
                  %small= number_to_currency r.sum(&:importo)
                %span.num_appunti
                  %small= r.count(&:appunto_id)
              = link_to "Registra",  new_fattura_url(causale: 1, cliente_id: c[:id]) 
            %ol
              - for a, righe in r.group_by(&:appunto) do
                %li.list-fixed= render "appunti/item", appunto: a
        - else
          %span.list-link 
            %small non ci sono appunti pagati da registrare 


    .module
      %ul
        %li
          %span.list-link.active 
            Da incassare e registrare
        - unless @clienti_righe_da_pagare.empty?
          - for c, r in @clienti_righe_da_pagare do
            %li
              = link_to  c, class: "list-link" do
                %span.titolo= c[:titolo]
                %span.copie
                  %small= r.sum(&:quantita)
                %span.importo
                  %small= number_to_currency r.sum(&:importo)
                %span.num_appunti
                  %small= r.count(&:appunto_id)
            = link_to "Registra",  new_fattura_url(causale: 1, cliente_id: c[:id]) 
            %ol
              - for a, righe in r.group_by(&:appunto) do
                %li.list-fixed= render "appunti/item", appunto: a
        - else
          %span.list-link 
            %small non ci sono appunti da incassare e registrare 


        
- @fattura = Fattura.new
= render "modal"
          
          



