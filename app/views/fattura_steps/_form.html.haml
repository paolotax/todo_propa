.row
  .span8
    .well.clearfix
      %h2
        = "#{@fattura.documento_causale} #{@fattura.numero} del #{l @fattura.data, format: :only_date}"
        %small= link_to @fattura.titolo, @fattura.cliente
        
      %br

      %ul.nav.nav-tabs
        - if @fattura.documento_scarico? && !@fattura.cliente.righe.da_fatturare.empty?
          %li{class: "#{step == :scegli_appunti ? 'active' : ''}"}
            = link_to "Scegli appunti", wizard_path(:scegli_appunti)      
 
        - if @fattura.documento_carico? && !@fattura.cliente.righe_documenti.completare_carico.di_quest_anno.empty?
          %li{class: "#{step == :scegli_appunti ? 'active' : ''}"}
            = link_to "Scegli documenti", wizard_path(:scegli_appunti)      

        %li{class: "dropdown #{step == :vacanze ? 'active' : ''}"}
          %a.dropdown-toggle{ href: '#', "data-toggle" => 'dropdown'}
            Libri per settore
            %b.caret
          %ul.dropdown-menu
            -Libro::SETTORI.each do |settore|
              %li= link_to settore, wizard_path(:vacanze, settore: settore)
             
        %li{class: "#{step == :leggi ? 'active' : ''}"}   
          = link_to "Importa", wizard_path(:leggi)
        %li{class: "#{step == :dettaglio ? 'active' : ''}"}   
          = link_to "Dettaglio righe", wizard_path(:dettaglio)
        %li{class: "#{step == :intestazione ? 'active' : ''}"}  
          = link_to "Modifica intestazione", wizard_path(:intestazione)
      
      %br

      = simple_nested_form_for @fattura, url: wizard_path do |f|
        = f.error_notification      
        = yield f

  
  .span4
    
    - libri = @fattura.righe.map(&:libro).select{|l| l.anagrafica_da_completare? == true}.uniq
    - unless libri.empty?
      .well
      - for libro in libri do
        = render libro

    - if @fattura.documento_causale
      .well
        = link_to "#{@fattura.documento_causale.pluralize} #{@fattura.data.year}", fatture_path(causale: @fattura.documento_causale, anno: @fattura.data.year)
