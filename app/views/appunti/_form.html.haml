= simple_nested_form_for @appunto do |f|
  = f.error_notification
  = f.input :cliente_id, :collection => current_user.clienti.order(:titolo), :label_method => :titolo, :value_method => :id, :input_html => { :class => 'chzn-select', "data-placeholder" => "Seleziona il cliente..." }

  %ul.nav.nav-tabs.tab
    %li.active
      %a{ href: "#info",      "data-toggle" => "tab"} Appunto
    %li
      %a{ href: "#dettaglio", "data-toggle" => "tab"} Dettaglio righe
    %li
      %a{ href: "#vacanze", "data-toggle" => "tab"} Inserisci vacanze...  

  .tab-content

    #info.tab-pane.fade.active.in
      = f.input :destinatario
      = f.input :note, :input_html => { rows: 5 }
      = f.input :telefono
      = f.input :email
      %hr
      = f.input :stato,  :collection => [ ["in sospeso", "P"], ["completo", "X"], ["da fare", ""]], as: :radio_buttons
    
    #dettaglio.tab-pane.fade
      .control-group
        %label.control-label Condizioni di pagamento:
        .controls
          %label.radio.inline
            = radio_button_tag 'prezzo', 'consigliato', true
            prezzo consigliato
          %label.radio.inline
            = radio_button_tag 'prezzo', 'con_sconto', false
            sconto
            = select_tag 'prezzo', options_for_select([0, 10, 15, 18, 20, 25, 30, 35, 43], 20), class: 'input-mini'
      
      .control-group
        = render 'righe/form'
        
        #righe
          - if f.object.righe.empty?
            .empty
              Nessuna riga in questo ordine...
          - else
            = f.simple_fields_for :righe do |riga|
              = div_for riga.object, class: 'form-inline' do
                = riga.hidden_field :id
                = riga.hidden_field :libro_id
                .titolo= riga.object.libro.titolo
                .pull-right
                  = riga.number_field :quantita, class: 'input-mini riga_quantita'
                  = riga.number_field :prezzo,   class: 'input-mini riga_prezzo'
                  = riga.number_field :sconto,   class: 'input-mini riga_sconto'
                  = riga.link_to_remove raw("<i class='icon-minus'></i>"), class: "btn btn-danger btn-mini"
    
    #vacanze.tab-pane.fade
      .control-group
        #righe
          - @appunto.create_righe_vacanze
          = f.simple_fields_for :righe do |riga|
            - if riga.object.new_record?
              = div_for riga.object, class: 'form-inline' do
                = riga.hidden_field :id
                = riga.hidden_field :libro_id
                .titolo= riga.object.libro.titolo
                .pull-right
                  = riga.number_field :quantita, class: 'input-mini riga_quantita'
                  = riga.number_field :prezzo,   class: 'input-mini riga_prezzo'
                  = riga.number_field :sconto,   class: 'input-mini riga_sconto'
            - else
              .hidden
      
  = f.error :base

  / .control-group
  /   .controls
  .form-actions
    %button{:class => "btn btn-primary", :type => "submit", id: "new_appunto_submit"} Salva
    = link_to "Annulla", :back, class: "btn btn-danger"
  
